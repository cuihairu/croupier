syntax = "v1"

info (
	title: "Croupier Agent API"
	desc:  "go-zero migration of agent management APIs"
)

type (
	// Agent registration request
	AgentRegisterRequest {
		GameId     string `json:"game_id"`
		Env        string `json:"env"`
		AgentId    string `json:"agent_id"`
		RpcAddr    string `json:"rpc_addr"`
		Ip         string `json:"ip"`
		Type       string `json:"type"`
		Version    string `json:"version"`
		Functions  int64  `json:"functions"`
		Metadata   map[string]string `json:"metadata,optional"`
	}

	// Agent registration response
	AgentRegisterResponse {
		Success bool   `json:"success"`
		Message string `json:"message"`
		Token   string `json:"token,optional"`
	}

	// Agent heartbeat request
	AgentHeartbeatRequest {
		AgentId   string `json:"agent_id"`
		GameId    string `json:"game_id"`
		Env       string `json:"env"`
		Functions int64  `json:"functions"`
		Status    string `json:"status"`
		Metadata  map[string]string `json:"metadata,optional"`
	}

	// Agent heartbeat response
	AgentHeartbeatResponse {
		Success    bool `json:"success"`
		NextHeartbeat int64 `json:"next_heartbeat"`
	}

	// Function registration request
	FunctionRegisterRequest {
		GameId     string `json:"game_id"`
		Env        string `json:"env"`
		FunctionId string `json:"function_id"`
		Descriptor map[string]interface{} `json:"descriptor"`
		Schema     map[string]interface{} `json:"schema,optional"`
		Metadata   map[string]interface{} `json:"metadata,optional"`
	}

	// Function registration response
	FunctionRegisterResponse {
		Success bool   `json:"success"`
		Message string `json:"message"`
	}

	// Job execution request
	JobExecuteRequest {
		JobId      string `json:"job_id"`
		FunctionId string `json:"function_id"`
		GameId     string `json:"game_id"`
		Env        string `json:"env"`
		Inputs     map[string]interface{} `json:"inputs"`
		Options    map[string]interface{} `json:"options,optional"`
	}

	// Job execution response
	JobExecuteResponse {
		Success bool `json:"success"`
		JobId   string `json:"job_id"`
		Status  string `json:"status"`
	}

	// Job status request
	JobStatusRequest {
		JobId string `path:"job_id"`
	}

	// Job status response
	JobStatusResponse {
		JobId      string `json:"job_id"`
		Status     string `json:"status"`
		Result     map[string]interface{} `json:"result,optional"`
		Error      string `json:"error,optional"`
		Progress   int64  `json:"progress"`
		StartTime  string `json:"start_time"`
		EndTime    string `json:"end_time,optional"`
	}

	// Agent health check request
	AgentHealthRequest {
		AgentId string `path:"agent_id"`
	}

	// Agent health response
	AgentHealthResponse {
		Status    string `json:"status"`
		Uptime    int64  `json:"uptime"`
		Jobs      int64  `json:"active_jobs"`
		Functions int64  `json:"functions"`
		Memory    int64  `json:"memory_usage"`
		Cpu       float64 `json:"cpu_usage"`
	}

	// Agent metrics request
	AgentMetricsRequest {
		AgentId string `path:"agent_id"`
		Start   string `form:"start,optional"`
		End     string `form:"end,optional"`
	}

	// Agent metrics response
	AgentMetricsResponse {
		Metrics map[string]interface{} `json:"metrics"`
	}
)

@server (
	prefix: /api/v1
	group:  agent
)
service croupier-agent {
	// Agent registration and management
	@handler AgentRegisterHandler
	post /agent/register (AgentRegisterRequest) returns (AgentRegisterResponse)

	@handler AgentHeartbeatHandler
	post /agent/heartbeat (AgentHeartbeatRequest) returns (AgentHeartbeatResponse)

	@handler AgentHealthHandler
	get /agent/:agent_id/health (AgentHealthRequest) returns (AgentHealthResponse)

	@handler AgentMetricsHandler
	get /agent/:agent_id/metrics (AgentMetricsRequest) returns (AgentMetricsResponse)

	// Function management
	@handler FunctionRegisterHandler
	post /function/register (FunctionRegisterRequest) returns (FunctionRegisterResponse)

	// Job management
	@handler JobExecuteHandler
	post /job/execute (JobExecuteRequest) returns (JobExecuteResponse)

	@handler JobStatusHandler
	get /job/:job_id/status (JobStatusRequest) returns (JobStatusResponse)
}