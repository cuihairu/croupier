# Example server configuration (YAML)

server:
  # Listen addresses
  addr: ":8443"      # gRPC (mTLS)
  http_addr: ":8080" # HTTP API/UI

  # TLS (dev: empty to auto-generate under configs/dev)
  cert: ""
  key: ""
  ca:  ""

  # Database selection
  db:
    driver: auto   # postgres | mysql | sqlite | mssql | sqlserver | auto
    dsn: ""       # Postgres:   postgres://user:pass@host:5432/croupier?sslmode=disable
                   # MySQL(URL): mysql://user:pass@host:3306/croupier?charset=utf8mb4
                   # MySQL(DSN): user:pass@tcp(host:3306)/croupier?parseTime=true&charset=utf8mb4
                   # SQL Server: sqlserver://user:pass@host:1433?database=croupier
                   # SQLite:     file:data/croupier.db (defaults to data/croupier.db when empty)

  # Object storage (uploads/asset hosting)
  storage:
    driver: s3     # s3 | cos | oss | file
    bucket: my-bucket
    region: ap-shanghai
    endpoint: https://cos.ap-shanghai.myqcloud.com   # s3/minio endpoint; COS 可单独用 driver: cos
    access_key: "${STORAGE_AK}"
    secret_key: "${STORAGE_SK}"
    force_path_style: true        # s3/cos/minio 建议 true
    signed_url_ttl: 15m
    # file driver (dev): base_dir: data/uploads

  # COS 专用（官方 SDK 驱动）示例：
  # storage:
  #   driver: cos
  #   bucket: your-bucket-APPID
  #   region: ap-shanghai
  #   endpoint: https://cos.ap-shanghai.myqcloud.com   # 可省略，自动根据 bucket+region 组装
  #   access_key: ${TENCENT_SECRET_ID}
  #   secret_key: ${TENCENT_SECRET_KEY}
  #   signed_url_ttl: 15m

  # Files (RBAC/users/examples)
  rbac_config:   "configs/rbac.json"
  users_config:  "configs/users.json"
  games_config:  "configs/games.json"    # whitelist (legacy); metadata is managed via /api/games_meta
  jwt_secret:    "dev-secret"            # change in production

  # Logging
  log:
    level:  info       # debug|info|warn|error
    format: console    # console|json
    output: stdout     # stdout|stderr (default stdout)
    file:   ""         # optional file path (enables rotation)
    max_size:    100   # MB
    max_backups: 7
    max_age:     7     # days
    compress:    true

  # Metrics toggles
  metrics:
    per_function: true
    per_game_denies: false

  # Optional profile overlays
  profiles:
    prod:
      log: { level: info, format: json, file: logs/server.log }
      db:  { driver: postgres }
