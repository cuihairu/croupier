# Croupier å¯¹è±¡é©±åŠ¨çš„ç»„ä»¶åŒ–åå°ç®¡ç†ç³»ç»Ÿ

## ğŸ“‹ æ¦‚è¿°

åŸºäº JSON Schema é©±åŠ¨çš„å¯¹è±¡åŒ–æ¸¸æˆåå°ç®¡ç†ç³»ç»Ÿï¼Œå®ç°äº†ç±»ä¼¼ Ant Design Pro çš„ä½ä»£ç /æ— ä»£ç ç®¡ç†ç•Œé¢ç”Ÿæˆèƒ½åŠ›ã€‚

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Resource Layer                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ player.resource â”‚  â”‚  item.resource  â”‚  ...         â”‚
â”‚  â”‚   (ProTable)    â”‚  â”‚   (ProTable)    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Entity Definition Layer               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  player.entity  â”‚  â”‚   item.entity   â”‚  ...         â”‚
â”‚  â”‚  (JSON Schema)  â”‚  â”‚  (JSON Schema)  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Function Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ player.register â”‚  â”‚  item.create    â”‚  ...         â”‚
â”‚  â”‚ player.profile  â”‚  â”‚  item.list      â”‚              â”‚
â”‚  â”‚ player.ban      â”‚  â”‚  item.update    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¦‚å¿µ

#### 1. Entity (å®ä½“)
- **å®šä¹‰**: ä¸šåŠ¡å¯¹è±¡çš„å®Œæ•´æè¿°ï¼ŒåŒ…å« JSON Schemaã€UI é…ç½®ã€æ“ä½œæ˜ å°„
- **æ–‡ä»¶**: `*.entity.json`
- **ä½œç”¨**: å®šä¹‰æ•°æ®ç»“æ„ã€éªŒè¯è§„åˆ™ã€UI å±•ç¤ºæ–¹å¼
- **ç¤ºä¾‹**: `player.entity.json`, `item.entity.json`

#### 2. Function (å‡½æ•°)
- **å®šä¹‰**: å…·ä½“çš„ä¸šåŠ¡æ“ä½œå®ç°ï¼ŒåŒ…å«è¾“å…¥è¾“å‡º Schemaã€æƒé™ã€è¯­ä¹‰
- **æ–‡ä»¶**: `*.json` (é entity/resource ç±»å‹)
- **ä½œç”¨**: å®é™…çš„ CRUD æ“ä½œé€»è¾‘
- **ç¤ºä¾‹**: `player.register.json`, `item.create.json`

#### 3. Resource (èµ„æº)
- **å®šä¹‰**: UI å±‚é¢çš„æ“ä½œé›†åˆï¼Œå°†å¤šä¸ªå‡½æ•°ç»„åˆæˆå®Œæ•´çš„ç®¡ç†ç•Œé¢
- **æ–‡ä»¶**: `*.resource.json`
- **ä½œç”¨**: å®šä¹‰ ProTable é…ç½®ã€åˆ—å®šä¹‰ã€æ“ä½œæŒ‰é’®
- **ç¤ºä¾‹**: `player.resource.json`, `item.resource.json`

#### 4. Component (ç»„ä»¶)
- **å®šä¹‰**: åŠŸèƒ½æ¨¡å—çš„æ‰“åŒ…å•ä½ï¼ŒåŒ…å«ç›¸å…³çš„ entitiesã€functionsã€resources
- **æ–‡ä»¶**: `manifest.json`
- **ä½œç”¨**: æ¨¡å—åŒ–ç®¡ç†ã€ä¾èµ–æ§åˆ¶ã€å®‰è£…/å¸è½½
- **ç¤ºä¾‹**: `player-management`, `item-management`

## ğŸ”§ æŠ€æœ¯å®ç°

### JSON Schema é©±åŠ¨

ä½¿ç”¨ JSON Schema ä½œä¸ºæ ¸å¿ƒæè¿°è¯­è¨€ï¼š

```json
{
  "type": "object",
  "properties": {
    "username": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_]{3,16}$",
      "description": "ç”¨æˆ·å",
      "searchable": true
    }
  }
}
```

### å¯¹è±¡ç»‘å®šæœºåˆ¶

å‡½æ•°é€šè¿‡ `entity` å­—æ®µç»‘å®šåˆ°ä¸šåŠ¡å¯¹è±¡ï¼š

```json
{
  "id": "player.register",
  "entity": {
    "name": "player",
    "operation": "create"
  }
}
```

### UI è‡ªåŠ¨ç”Ÿæˆ

åŸºäº Entity å®šä¹‰è‡ªåŠ¨ç”Ÿæˆï¼š
- **ProTable**: åˆ—è¡¨é¡µé¢
- **ProForm**: è¡¨å•é¡µé¢
- **ProDescriptions**: è¯¦æƒ…é¡µé¢

## ğŸ“ ç›®å½•ç»“æ„

```
components/
â”œâ”€â”€ player-management/
â”‚   â”œâ”€â”€ manifest.json              # ç»„ä»¶æ¸…å•
â”‚   â””â”€â”€ descriptors/
â”‚       â”œâ”€â”€ player.entity.json     # ç©å®¶å®ä½“å®šä¹‰
â”‚       â”œâ”€â”€ player.resource.json   # ç©å®¶èµ„æºé…ç½®
â”‚       â”œâ”€â”€ player.register.json   # æ³¨å†Œå‡½æ•°
â”‚       â”œâ”€â”€ player.profile.get.json
â”‚       â”œâ”€â”€ player.profile.update.json
â”‚       â”œâ”€â”€ player.ban.json
â”‚       â”œâ”€â”€ player.unban.json
â”‚       â””â”€â”€ player.list.json
â”œâ”€â”€ item-management/
â”‚   â”œâ”€â”€ manifest.json
â”‚   â””â”€â”€ descriptors/
â”‚       â”œâ”€â”€ item.entity.json
â”‚       â”œâ”€â”€ item.resource.json
â”‚       â”œâ”€â”€ item.create.json
â”‚       â”œâ”€â”€ item.get.json
â”‚       â”œâ”€â”€ item.list.json
â”‚       â”œâ”€â”€ item.update.json
â”‚       â””â”€â”€ item.delete.json
â””â”€â”€ economy-system/
    â”œâ”€â”€ manifest.json
    â””â”€â”€ descriptors/
        â”œâ”€â”€ currency.resource.json
        â”œâ”€â”€ wallet.add.json
        â”œâ”€â”€ wallet.deduct.json
        â””â”€â”€ wallet.get.json
```

## ğŸ”„ å·¥ä½œæµç¨‹

### 1. å®šä¹‰å®ä½“ (Entity)
```json
{
  "id": "player.entity",
  "type": "entity",
  "schema": { /* JSON Schema */ },
  "operations": {
    "create": ["player.register"],
    "read": ["player.profile.get"],
    "update": ["player.profile.update"],
    "delete": ["player.ban"]
  },
  "ui": {
    "display_field": "username",
    "title_template": "{username} ({nickname})"
  }
}
```

### 2. å®ç°å‡½æ•° (Functions)
```json
{
  "id": "player.register",
  "entity": {
    "name": "player",
    "operation": "create"
  },
  "params": { /* è¾“å…¥ Schema */ },
  "result": { /* è¾“å‡º Schema */ },
  "auth": { /* æƒé™æ§åˆ¶ */ }
}
```

### 3. é…ç½®èµ„æº (Resource)
```json
{
  "id": "player.resource",
  "type": "resource",
  "operations": {
    "create": {"function": "player.register"},
    "read": {"function": "player.profile.get"}
  },
  "ui": {
    "type": "pro-table",
    "columns": [ /* åˆ—å®šä¹‰ */ ],
    "actions": ["create", "edit", "delete"]
  }
}
```

### 4. æ‰“åŒ…ç»„ä»¶ (Component)
```json
{
  "id": "player-management",
  "dependencies": [],
  "functions": [
    {"id": "player.register"},
    {"id": "player.profile.get"}
  ]
}
```

## ğŸ¯ ç³»ç»Ÿä¼˜åŠ¿

### 1. ä½ä»£ç /æ— ä»£ç 
- **å¯è§†åŒ–é…ç½®**: é€šè¿‡ç®¡ç†ç•Œé¢åˆ›å»ºå’Œç¼–è¾‘å®ä½“
- **è‡ªåŠ¨ç”ŸæˆUI**: åŸºäº JSON Schema è‡ªåŠ¨ç”Ÿæˆè¡¨å•å’Œè¡¨æ ¼
- **å³æ’å³ç”¨**: ç»„ä»¶åŒ–å®‰è£…å’Œå¸è½½

### 2. ç±»å‹å®‰å…¨
- **è¾“å…¥éªŒè¯**: JSON Schema éªŒè¯æ‰€æœ‰è¾“å…¥
- **è¾“å‡ºç±»å‹**: æ˜ç¡®çš„è¿”å›å€¼ç±»å‹å®šä¹‰
- **ç¼–è¯‘æ—¶æ£€æŸ¥**: å‰ç«¯å¯ä»¥åŸºäº Schema ç”Ÿæˆ TypeScript ç±»å‹

### 3. æƒé™æ§åˆ¶
- **ç»†ç²’åº¦**: å‡½æ•°çº§åˆ«çš„æƒé™æ§åˆ¶
- **çµæ´»ç­–ç•¥**: æ”¯æŒ RBAC å’Œ ABAC
- **æ¡ä»¶æƒé™**: `allow_if` è¡¨è¾¾å¼æ”¯æŒ

### 4. å¯æ‰©å±•æ€§
- **ç»„ä»¶åŒ–**: æ¨¡å—ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- **ä¾èµ–ç®¡ç†**: è‡ªåŠ¨è§£æç»„ä»¶ä¾èµ–å…³ç³»
- **ç‰ˆæœ¬æ§åˆ¶**: ç»„ä»¶å’Œå‡½æ•°çš„ç‰ˆæœ¬ç®¡ç†

## ğŸ“± å‰ç«¯é›†æˆ

### ProTable ç»„ä»¶
```typescript
<ResourceTable
  resourceId="player.resource"
  // è‡ªåŠ¨è¯»å– /api/descriptors?id=player.resource
  // æ ¹æ® operations å’Œ ui é…ç½®ç”Ÿæˆç•Œé¢
/>
```

### è‡ªåŠ¨è¡¨å•ç”Ÿæˆ
```typescript
<EntityForm
  entityId="player.entity"
  operation="create"
  // åŸºäº player.entity.json ç”Ÿæˆè¡¨å•
  // è°ƒç”¨ player.register å‡½æ•°
/>
```

## ğŸ”— API æ¥å£

### ç»„ä»¶ç®¡ç†
- `GET /api/components` - è·å–ç»„ä»¶åˆ—è¡¨
- `POST /api/components/install` - å®‰è£…ç»„ä»¶
- `DELETE /api/components/:id` - å¸è½½ç»„ä»¶
- `POST /api/components/:id/enable` - å¯ç”¨ç»„ä»¶
- `POST /api/components/:id/disable` - ç¦ç”¨ç»„ä»¶

### å®ä½“ç®¡ç† (è§„åˆ’ä¸­)
- `GET /api/entities` - è·å–å®ä½“åˆ—è¡¨
- `POST /api/entities` - åˆ›å»ºæ–°å®ä½“
- `PUT /api/entities/:id` - æ›´æ–°å®ä½“å®šä¹‰
- `DELETE /api/entities/:id` - åˆ é™¤å®ä½“
- `POST /api/entities/preview` - é¢„è§ˆå®ä½“ UI

### å‡½æ•°è°ƒç”¨
- `POST /api/invoke` - è°ƒç”¨å‡½æ•°
- `GET /api/descriptors` - è·å–å‡½æ•°æè¿°ç¬¦
- `GET /api/ui_schema` - è·å– UI Schema

## ğŸš€ å®ç°çŠ¶æ€

### âœ… å·²å®Œæˆ
1. **ç»„ä»¶ç®¡ç†ç³»ç»Ÿ**
   - ComponentManager å®ç°
   - ç»„ä»¶å®‰è£…/å¸è½½/å¯ç”¨/ç¦ç”¨
   - ä¾èµ–å…³ç³»æ£€æŸ¥
   - HTTP API é›†æˆ

2. **ç©å®¶ç®¡ç†ç»„ä»¶**
   - å®Œæ•´çš„ CRUD æ“ä½œ
   - å®ä½“å®šä¹‰ (player.entity.json)
   - èµ„æºé…ç½® (player.resource.json)
   - æ‰€æœ‰å‡½æ•°æè¿°ç¬¦

3. **ç‰©å“ç®¡ç†ç»„ä»¶**
   - åŸºç¡€ CRUD æ“ä½œ
   - å®ä½“å®šä¹‰ (item.entity.json)
   - èµ„æºé…ç½® (item.resource.json)
   - éƒ¨åˆ†å‡½æ•°æè¿°ç¬¦

4. **ç»æµç³»ç»Ÿç»„ä»¶**
   - è´§å¸ç®¡ç†èµ„æºé…ç½®
   - åŸºç¡€æ¶æ„

### ğŸ”„ è¿›è¡Œä¸­
1. **å®ä½“ç®¡ç†ç•Œé¢**
   - å¯è§†åŒ–å®ä½“åˆ›å»ºå’Œç¼–è¾‘
   - JSON Schema ç¼–è¾‘å™¨
   - UI é…ç½®å·¥å…·
   - é¢„è§ˆåŠŸèƒ½

### ğŸ“‹ å¾…å®ç°
è¯¦è§ä¸‹æ–¹ TODO List

## ğŸ¯ é•¿æœŸç›®æ ‡

1. **å®Œæ•´çš„ä½ä»£ç å¹³å°**
   - æ‹–æ‹½å¼ç•Œé¢è®¾è®¡å™¨
   - å·¥ä½œæµç¼–æ’
   - æ•°æ®æºè¿æ¥å™¨

2. **å¤šç§Ÿæˆ·æ”¯æŒ**
   - ç§Ÿæˆ·çº§åˆ«çš„ç»„ä»¶éš”ç¦»
   - æ•°æ®éš”ç¦»
   - æƒé™éš”ç¦»

3. **æ’ä»¶ç”Ÿæ€**
   - ç¬¬ä¸‰æ–¹ç»„ä»¶å¸‚åœº
   - ç»„ä»¶æ¨¡æ¿åº“
   - ç¤¾åŒºè´¡çŒ®æœºåˆ¶

---

è¿™ä¸ªæ¶æ„ä¸ºæ¸¸æˆåå°ç®¡ç†æä¾›äº†å¼ºå¤§çš„æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶å¤§å¤§é™ä½äº†æ–°åŠŸèƒ½å¼€å‘çš„é—¨æ§›ã€‚