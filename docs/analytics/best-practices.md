---
title: 最佳实践
---
# 生产部署建议

部署
- 分层部署：公网 Ingestion 与内网处理/存储分离；前置 CDN/WAF 与限流
- 消息队列：Redis Streams 小量入门，Kafka 作为规模化替代
- 无损发布：Worker 滚动升级，启用重试与死信，保持可重放

安全
- HMAC 签名 + 时间戳/nonce 防重放；按游戏/环境限流
- SDK/API 密钥分环境管理；最小权限访问 ClickHouse
- 数据脱敏：PII 字段分表/加密存储，按角色受控查询

数据治理
- 事件 schema 版本化，破坏性变更需灰度与迁移
- 维度卡控：限制高基数字段，避免 ClickHouse 表爆炸
- 指标 Owner 制度，明确口径与仪表板归属

监控与告警
- 入口 QPS、签名失败率、403/429、队列积压、Worker 失败率
- ClickHouse 写入延迟、分区健康、查询慢日志
- 异常检测：DAU/ARPU/支付转化等核心业务指标的环比/同比突变
